
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3Eüß™%3C/text%3E%3C/svg%3E">
    <title>Brownian Motion Simulation</title>
    <script src="layout2.js"></script>
    <style>
        :root {
            --bg-dark: #05070a;
            --neon-blue: #00f3ff;
            --neon-yellow: #ffd700;
            --glass: rgba(20, 30, 40, 0.6);
            --border: rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: var(--bg-dark);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            color: white;
        }

        /* Main Container */
        #simulation-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        canvas {
            display: block;
        }

        /* Microscope Vignette Overlay */
        #microscope-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            background: radial-gradient(circle, transparent 40%, rgba(0,0,0,0.8) 85%, black 100%);
            z-index: 2;
            box-shadow: inset 0 0 100px rgba(0, 20, 40, 0.5);
        }

        /* UI Controls */
        #ui-panel {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 600px;
            background: var(--glass);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 25px;
            z-index: 10;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
            margin-bottom: 5px;
        }

        h1 { margin: 0; font-size: 20px; font-weight: 700; letter-spacing: 1px; color: var(--neon-blue); text-transform: uppercase; }
        .subtitle { font-size: 12px; color: #aaa; }

        /* Sliders */
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .label-row { display: flex; justify-content: space-between; font-size: 14px; font-weight: 600; }
        .value-display { font-family: monospace; color: var(--neon-yellow); }

        input[type=range] {
            width: 100%;
            -webkit-appearance: none;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px; width: 18px;
            border-radius: 50%;
            background: white;
            margin-top: -7px;
            cursor: pointer;
            box-shadow: 0 0 10px white;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px;
            cursor: pointer;
            background: linear-gradient(90deg, #333, var(--neon-blue), #ff4444);
            border-radius: 2px;
        }

        /* Info Box (Top Left) */
        #info-box {
            position: absolute;
            top: 30px; left: 30px;
            background: var(--glass);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--neon-yellow);
            max-width: 300px;
            z-index: 10;
            backdrop-filter: blur(5px);
        }
        #info-box h2 { margin: 0 0 10px 0; font-size: 16px; color: var(--neon-yellow); }
        #info-box p { margin: 0; font-size: 13px; line-height: 1.5; color: #ddd; }

        /* Floating labels in canvas */
        .annotation {
            position: absolute;
            color: rgba(255,255,255,0.5);
            font-size: 12px;
            pointer-events: none;
            z-index: 5;
        }

    </style>
</head>
<body>

    <div id="simulation-container">
        <canvas id="simCanvas"></canvas>
        <div id="microscope-overlay"></div>

        <!-- Educational Context -->
        <div id="info-box">
            <h2>Microscopic View (1000x)</h2>
            <p>
                Observe the large <strong>Pollen Grain</strong> (Yellow). 
                It seems to move randomly, but it is actually being bombarded by thousands of invisible 
                <strong>Water Molecules</strong> (Blue).
            </p>
            <p style="margin-top:10px; font-style:italic; color:#aaa;">
                This confirms that matter is made of particles in constant motion.
            </p>
        </div>

        <!-- Controls -->
        <div id="ui-panel">
            <header>
                <div>
                    <h1>Brownian Motion</h1>
                    <span class="subtitle">Kinetic Theory of Matter</span>
                </div>
                <div style="text-align:right">
                    <span class="value-display" id="ke-display">0.00 J</span><br>
                    <span class="subtitle">System Energy</span>
                </div>
            </header>

            <div class="control-group">
                <div class="label-row">
                    <span>üå°Ô∏è Temperature (Molecular Speed)</span>
                    <span id="temp-val" class="value-display">300 K</span>
                </div>
                <input type="range" id="temp-slider" min="100" max="1000" value="300" step="10">
            </div>

            <div class="control-group">
                <div class="label-row">
                    <span>üëª Motion Trail Intensity</span>
                    <span id="trail-val" class="value-display">Medium</span>
                </div>
                <input type="range" id="trail-slider" min="0" max="0.9" value="0.2" step="0.1">
            </div>
        </div>

        <div id="label-pollen" class="annotation">POLLEN GRAIN</div>
    </div>

<script>
    /**
     * BROWNIAN MOTION SIMULATION
     * 
     * Technical Note:
     * We use a simplified elastic collision model. 
     * To maintain high performance (60FPS) with many particles, 
     * we focus on Water-Pollen collisions and simplified Water-Wall physics.
     */

    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');
    
    // Configuration
    const CONFIG = {
        particleCount: 400,
        baseSpeed: 2,
        pollenRadius: 40,
        waterRadius: 3,
        trailAlpha: 0.2, // Determines how long trails stick around
        temperature: 300 // Kelvin base
    };

    let width, height;
    let particles = [];
    let pollen;

    // --- CLASS DEFINITIONS ---

    class Particle {
        constructor(x, y, radius, mass, isPollen = false) {
            this.x = x;
            this.y = y;
            this.radius = radius;
            this.mass = mass;
            this.isPollen = isPollen;
            
            // Random velocity vector
            const angle = Math.random() * Math.PI * 2;
            const speed = isPollen ? 0 : (Math.random() * 0.5 + 0.5) * CONFIG.baseSpeed;
            
            this.vx = Math.cos(angle) * speed;
            this.vy = Math.sin(angle) * speed;
        }

        update(tempMultiplier) {
            // Apply Temperature Factor to movement
            // Pollen moves based on momentum from collisions, not directly by temp multiplier
            // Water moves directly by temp
            
            let dx = this.vx;
            let dy = this.vy;

            if (!this.isPollen) {
                dx *= tempMultiplier;
                dy *= tempMultiplier;
            }

            this.x += dx;
            this.y += dy;

            // Wall Collisions
            if (this.x - this.radius < 0) { this.x = this.radius; this.vx *= -1; }
            if (this.x + this.radius > width) { this.x = width - this.radius; this.vx *= -1; }
            if (this.y - this.radius < 0) { this.y = this.radius; this.vy *= -1; }
            if (this.y + this.radius > height) { this.y = height - this.radius; this.vy *= -1; }
        }

        draw(ctx, tempFactor) {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            
            if (this.isPollen) {
                // Pollen Style: Textured/Cellular look
                const grad = ctx.createRadialGradient(this.x, this.y, this.radius * 0.2, this.x, this.y, this.radius);
                grad.addColorStop(0, '#fff');
                grad.addColorStop(0.3, '#ffd700'); // Gold
                grad.addColorStop(1, '#d4af37');
                ctx.fillStyle = grad;
                ctx.shadowBlur = 20;
                ctx.shadowColor = '#ffd700';
            } else {
                // Water Molecule Style: Glowing Dot
                // Color shifts redder as temp increases
                const r = Math.min(255, Math.floor((tempFactor - 1) * 200));
                const g = 243;
                const b = 255;
                
                ctx.fillStyle = `rgba(${r}, ${g}, ${b}, 0.8)`;
                ctx.shadowBlur = 0;
            }
            
            ctx.fill();
            ctx.closePath();
        }
    }

    // --- PHYSICS ENGINE ---

    function resolveCollision(p1, p2) {
        const dx = p2.x - p1.x;
        const dy = p2.y - p1.y;
        const dist = Math.sqrt(dx * dx + dy * dy);

        if (dist < p1.radius + p2.radius) {
            // 1. Calculate Normal and Tangent vectors
            const nx = dx / dist;
            const ny = dy / dist;
            // Tangent is perpendicular to Normal
            const tx = -ny;
            const ty = nx;

            // 2. Dot Product Tangent (Velocity projected onto tangent)
            const dpTan1 = p1.vx * tx + p1.vy * ty;
            const dpTan2 = p2.vx * tx + p2.vy * ty;

            // 3. Dot Product Normal (Velocity projected onto normal)
            const dpNorm1 = p1.vx * nx + p1.vy * ny;
            const dpNorm2 = p2.vx * nx + p2.vy * ny;

            // 4. Conservation of Momentum in 1D (Normal direction)
            const m1 = p1.mass;
            const m2 = p2.mass;

            const mom1 = (dpNorm1 * (m1 - m2) + 2 * m2 * dpNorm2) / (m1 + m2);
            const mom2 = (dpNorm2 * (m2 - m1) + 2 * m1 * dpNorm1) / (m1 + m2);

            // 5. Update Velocities (Scalar Normal + Original Tangent)
            // Note: We only scale the normal component by the temperature multiplier logic implicitly via mass
            
            p1.vx = tx * dpTan1 + nx * mom1;
            p1.vy = ty * dpTan1 + ny * mom1;
            p2.vx = tx * dpTan2 + nx * mom2;
            p2.vy = ty * dpTan2 + ny * mom2;

            // 6. Prevent Sticking (Overlap correction)
            const overlap = (p1.radius + p2.radius - dist) / 2;
            p1.x -= overlap * nx;
            p1.y -= overlap * ny;
            p2.x += overlap * nx;
            p2.y += overlap * ny;
        }
    }

    // --- INIT & LOOP ---

    function init() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
        
        particles = [];
        
        // Create Pollen (Center) - Massive
        pollen = new Particle(width/2, height/2, CONFIG.pollenRadius, 500, true); // Mass 500
        
        // Create Water Molecules - Light
        for(let i=0; i<CONFIG.particleCount; i++) {
            // Ensure they don't spawn inside the pollen
            let px, py, dist;
            do {
                px = Math.random() * width;
                py = Math.random() * height;
                const dx = px - width/2;
                const dy = py - height/2;
                dist = Math.sqrt(dx*dx + dy*dy);
            } while(dist < CONFIG.pollenRadius + 20);

            particles.push(new Particle(px, py, CONFIG.waterRadius, 1, false)); // Mass 1
        }
    }

    function animate() {
        requestAnimationFrame(animate);

        // 1. Trail Effect
        // Instead of clearing the canvas, we draw a semi-transparent rectangle over it.
        // This makes old frames fade out slowly, creating trails.
        ctx.fillStyle = `rgba(5, 7, 10, ${CONFIG.trailAlpha})`;
        ctx.fillRect(0, 0, width, height);

        // 2. Get Temperature Factor
        const currentTemp = parseInt(document.getElementById('temp-slider').value);
        // Normalize: 300K = 1.0 speed multiplier
        const speedFactor = Math.sqrt(currentTemp / 300); // V is proportional to sqrt(T)

        // 3. Update & Draw Water
        particles.forEach(p => {
            p.update(speedFactor);
            
            // Check Collision with Pollen
            // We assume water molecules are effectively points relative to pollen for simplicity, 
            // but circular collision is better.
            // To simulate the "Heat", we scale the effective velocity of the water particle during collision
            
            // Temporary velocity scaling for collision calculation
            const originalVx = p.vx;
            const originalVy = p.vy;
            p.vx *= speedFactor;
            p.vy *= speedFactor;

            resolveCollision(p, pollen);

            // Revert velocity scaling (stored in vector) but keep the direction change
            // The energy transfer happened in resolveCollision
            p.vx /= speedFactor; 
            p.vy /= speedFactor;

            p.draw(ctx, speedFactor);
        });

        // 4. Update & Draw Pollen
        // Pollen naturally has friction/drag in water, so we dampen its velocity slightly
        pollen.vx *= 0.99; 
        pollen.vy *= 0.99;
        
        pollen.update(1); // Pollen moves by its own momentum
        pollen.draw(ctx, 1);

        // 5. Update Labels
        updateLabelPosition(pollen);
        updateUI(currentTemp, speedFactor);
    }

    // --- UI HELPERS ---

    function updateLabelPosition(pollen) {
        const label = document.getElementById('label-pollen');
        label.style.left = (pollen.x + 30) + 'px';
        label.style.top = (pollen.y - 30) + 'px';
    }

    function updateUI(temp, speedFactor) {
        document.getElementById('temp-val').innerText = temp + " K";
        
        // Calculate pseudo Kinetic Energy of the system
        // KE = 0.5 * m * v^2 (Sum of all water molecules)
        // Varies with square of speedFactor
        const ke = (CONFIG.particleCount * 0.5 * 1 * Math.pow(CONFIG.baseSpeed * speedFactor, 2)) / 100;
        document.getElementById('ke-display').innerText = ke.toFixed(2) + " aJ"; // attajoules (fake unit for scale)
    }

    // Slider Listeners
    document.getElementById('trail-slider').addEventListener('input', (e) => {
        // Invert slider: Low value = Long trails (Low Alpha), High value = Short trails (High Alpha)
        // The slider goes 0 (Long) to 0.9 (Short)
        CONFIG.trailAlpha = 1 - parseFloat(e.target.value);
        
        let text = "Medium";
        if(e.target.value < 0.3) text = "Long (Blurry)";
        if(e.target.value > 0.7) text = "Short (Crisp)";
        document.getElementById('trail-val').innerText = text;
    });

    // Resize Handle
    window.addEventListener('resize', init);

    // Start
    init();
    animate();

</script>
</body>
</html>
```